import{j as e,F as b,c as D,r as o,u as y,d as I,p as E,e as P,f as T,h as F,b as R,l as O,i as A,O as S,L}from"./index-7c40f22d.js";import{F as U,a as Y}from"./index-42ecab61.js";function $({rating:i}){const r=[];for(let a=0;a<5;a++)a<i?r.unshift(1):r.unshift(0);return e.jsx("div",{className:"star-scale",children:r.map((a,d)=>a===1?e.jsx(b,{},d):e.jsx(D,{},d))})}function B({review:i}){const r={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},a=new Date(i.createdAt);return e.jsxs("div",{className:"review-card",children:[e.jsx("div",{children:e.jsx("h4",{children:i.User.firstName})}),e.jsxs("div",{className:"review-date-stars",children:[e.jsx($,{rating:i.stars}),e.jsx("div",{children:" ∙ "}),e.jsxs("h5",{children:[r[a.getMonth()]," ",a.getFullYear()]})]}),e.jsx("div",{className:"review-text",children:i.review})]})}function H({spotId:i,setReviewChecker:r}){const[a,d]=o.useState(""),[c,h]=o.useState(0),[u,t]=o.useState({}),[w,j]=o.useState(!1),[N,v]=o.useState(!1),x=y(),{closeModal:p}=I();o.useEffect(()=>{a.length>=10&&c>0?v(!1):v(!0)},[a,c]);const g=l=>{h(l+1)},f=async l=>(l.preventDefault(),l.stopPropagation(),t({}),j(!1),x(E({review:{review:a,stars:c,spotId:parseInt(i)}})).then(async n=>{if((n==null?void 0:n.status)===500)t({message:"User can only review a spot once"});else{const m=await(n==null?void 0:n.json());m!=null&&m.errors&&t(m.errors),r(!0),p()}j(!0),u.values.length===0&&(r(!0),p())}));return e.jsx("div",{className:"post-review-container",children:e.jsxs("form",{className:"post-review-form",onSubmit:f,children:[e.jsx("h1",{children:"How was your stay?"}),w?e.jsx("p",{children:u.message}):"",e.jsx("textarea",{className:"review-input",value:a,onChange:l=>d(l.target.value),placeholder:"Leave your review here..."}),e.jsx("div",{className:"stars",children:Array.from({length:5},(l,n)=>e.jsx("div",{className:"post-reviewstar",onClick:()=>g(n),children:n<c?e.jsx(b,{}):e.jsx(D,{})},n))}),e.jsx("button",{className:"post-review-button",type:"submit",disabled:N,children:"Submit Your Review"})]})})}function J({reviewId:i,setDeleteReviewChecker:r}){const a=y(),{closeModal:d}=I(),c=h=>{h.preventDefault(),h.stopPropagation(),a(P(i)).then(()=>{r(!0)}).then(d)};return e.jsxs("div",{className:"confirm-delete-container",children:[e.jsx("h1",{children:"Confirm Delete"}),e.jsx("span",{children:"Are you sure you want to delete this review?"}),e.jsxs("div",{className:"delete-buttons-container",children:[e.jsx("button",{className:"yes-button-modal",onClick:h=>c(h),children:"Yes (Delete Review)"}),e.jsx("button",{className:"no-button-modal",onClick:d,children:"No (Keep Review)"})]})]})}function z({review:i,setReviewEditChecker:r}){const[a,d]=o.useState(i.review),[c,h]=o.useState(i.stars),[u,t]=o.useState({}),[w,j]=o.useState(!1),[N,v]=o.useState(!1),x=y(),{closeModal:p}=I();o.useEffect(()=>{a.length>=10&&c>0?v(!1):v(!0)},[a,c]);const g=l=>{h(l+1)},f=async l=>(l.preventDefault(),l.stopPropagation(),t([]),j(!1),x(T({id:i.id,review:a,stars:c})).then(()=>{r(!0)}).then(p).catch(async n=>{const m=await n.json();m!=null&&m.errors&&t(u)}));return e.jsx("div",{className:"post-review-container",children:e.jsxs("form",{className:"post-review-form",onSubmit:f,children:[e.jsx("h1",{children:"How was your stay?"}),w?e.jsx("p",{children:u.message}):"",e.jsx("textarea",{className:"review-input",value:a,onChange:l=>d(l.target.value),placeholder:"Leave your review here..."}),e.jsx("div",{className:"stars",children:Array.from({length:5},(l,n)=>e.jsx("div",{className:"post-reviewstar",onClick:()=>g(n),children:n<c?e.jsx(b,{}):e.jsx(D,{})},n))}),e.jsx("button",{className:"post-review-button",type:"submit",disabled:N,children:"Submit Your Review"})]})})}function X(){var n,m,M,k;const i=y(),{spotId:r}=F(),a=R(s=>s.session.user),[d,c]=o.useState(!1),[h,u]=o.useState(!1);o.useEffect(()=>{i(O(parseInt(r))),i(A(parseInt(r))).then(()=>u(!1))},[i,r,d,h]);const t=R(s=>s.spots.spot),w=R(s=>s.reviews.allReviews),j=R(s=>s.session.user),N=()=>{c(!1),i(A(parseInt(r)))};if(!t)return e.jsx("div",{className:"loading-spot",children:e.jsx("img",{src:"https://media.tenor.com/On7kvXhzml4AAAAj/loading-gif.gif",alt:"loading animation",style:{height:"40px",width:"40px"}})});if(!w)return e.jsx("div",{children:"Loading reviews..."});const v=((n=t.SpotImages)==null?void 0:n.filter(s=>s.preview===!0))||[],x=((m=t.SpotImages)==null?void 0:m.filter(s=>s.preview===!1))||[];let p="New!";t.avgStarRating&&(p=t.avgStarRating.toFixed(1).toString());const g=x.slice(0,4),f=s=>{s.preventDefault(),s.stopPropagation(),window.alert("Feature Coming Soon...")},l=()=>{u(s=>!s)};return e.jsxs("div",{className:"spot-details",children:[e.jsxs("div",{className:"header",children:[e.jsx("h1",{children:t.name}),e.jsxs("span",{children:[t.city,", ",t.state,", ",t.country]})]}),e.jsxs("div",{className:"images",children:[e.jsx("div",{className:"left-image-panel",children:v.length>0&&e.jsx("img",{src:v[0].url,alt:"Main preview"},v[0].id)}),x.length===1?e.jsx("div",{className:"right-image-panel-1",children:g.map((s,C)=>e.jsxs("div",{className:"image-container-1",children:[e.jsx("img",{className:"image-tile",src:s.url,alt:`Image ${s.id}`}),C===3&&x.length>4&&e.jsx("button",{className:"all-pictures-button",children:"All Pictures"})]},s.id))}):e.jsx("div",{className:"right-image-panel",children:g.map((s,C)=>e.jsxs("div",{className:"image-container",children:[e.jsx("img",{className:"image-tile",src:s.url,alt:`Image ${s.id}`}),C===3&&x.length>4&&e.jsx("button",{className:"all-pictures-button",children:"All Pictures"})]},s.id))})]}),e.jsxs("div",{className:"description-panel",children:[e.jsxs("div",{className:"description-panel-left",children:[e.jsxs("h2",{children:["Hosted by ",(M=t.Owner)==null?void 0:M.firstName," ",(k=t.Owner)==null?void 0:k.lastName]}),e.jsx("span",{className:"description",children:t.description})]}),e.jsxs("div",{className:"description-panel-right",children:[e.jsxs("div",{className:"price-reviews",children:[e.jsxs("div",{className:"price",children:[e.jsxs("span",{className:"price-span",children:["$",t.price," "]}),e.jsx("span",{children:"night"})]}),e.jsxs("div",{className:"reviews",children:[e.jsxs("div",{className:"avg-reviews",children:[e.jsx(b,{}),e.jsx("span",{children:p})]}),e.jsx("div",{className:"num-reviews",children:t.numReviews!==0?t.numReviews===1?e.jsxs("span",{children:[t.numReviews," review"]}):e.jsxs("span",{children:[t.numReviews," reviews"]}):e.jsx("span",{})})]})]}),e.jsx("div",{className:"reserve",children:e.jsx("button",{className:"reserve-button",onClick:s=>f(s),children:"Reserve"})})]})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"reviews2",children:[e.jsxs("div",{className:"reviews2-top",children:[e.jsxs("div",{className:"avg-reviews2",children:[e.jsx(b,{}),e.jsx("span",{children:p})]}),e.jsx("span",{children:t.numReviews!==0?"·":""}),e.jsx("div",{className:"num-reviews2",children:t.numReviews!==0?t.numReviews===1?e.jsxs("span",{children:[t.numReviews," review"]}):e.jsxs("span",{children:[t.numReviews," reviews"]}):e.jsx("span",{})})]}),e.jsx("div",{className:"post-review",children:a!==null&&a.id!==t.ownerId?e.jsx("div",{className:"post-review-button",children:e.jsx(S,{itemText:"Post your Review",modalComponent:e.jsx(H,{setReviewChecker:c,spotId:parseInt(r),onModalClose:()=>{}})})}):a===null&&e.jsx("div",{className:"log-in-to-review",children:e.jsx(S,{itemText:"Log In to Review",modalComponent:e.jsx(L,{}),onModalClose:N})})})]}),e.jsxs("div",{className:"reviews-container",children:[t.numReviews===0&&a!==null&&a.id!==t.ownerId?e.jsx("span",{className:"be-the-first",children:"Be the first to post a review!"}):"",t.numReviews===0?e.jsx("div",{}):w.map(s=>e.jsxs("div",{className:"review-and-button",children:[e.jsx("div",{className:"divider-horizontal"}),e.jsx(B,{review:s},s.id),j&&s.User.id===j.id?e.jsxs("div",{className:"crud-buttons-container",children:[e.jsxs("button",{className:"edit-review-button",children:[e.jsx(U,{}),e.jsx(S,{itemText:"Edit",modalComponent:e.jsx(z,{review:s,setReviewEditChecker:u})})]},s.id),e.jsxs("button",{className:"delete-review-button",children:[e.jsx(Y,{}),e.jsx(S,{itemText:"Delete",modalComponent:e.jsx(J,{reviewId:s.id,setDeleteReviewChecker:u}),onModalClose:async()=>{await l}})]},s.id)]},s.id):""]},s.id))]})]})}export{X as default};
